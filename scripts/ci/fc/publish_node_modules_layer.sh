#!/usr/bin/env bash
set -euo pipefail

required_vars=(
  ALIYUN_FC_REGION
  ALIYUN_FC_NODE_MODULES_LAYER_NAME
)

for var_name in "${required_vars[@]}"; do
  if [ -z "${!var_name:-}" ]; then
    echo "Missing required env var: ${var_name}" >&2
    exit 1
  fi
done

branch_name="${GITHUB_REF_NAME:-unknown}"

s cli fc3 layer publish \
  --region "$ALIYUN_FC_REGION" \
  --layer-name "$ALIYUN_FC_NODE_MODULES_LAYER_NAME" \
  --code apps/backend/.layer \
  --compatible-runtime custom.debian12 \
  --description "PartnerUp backend ${branch_name} node_modules" \
  -a default
